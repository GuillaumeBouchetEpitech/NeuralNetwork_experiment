(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";function NeuralNetwork(r){if(this._m_error=0,this._m_recentAvgError=0,this._m_arr_layers=[],0==r.length)throw new Error("(arr_topology.length == 0)");for(var t=0;t<r.length;++t){var e=r[t];if(e<=0)throw new Error("(num_neuron <= 0)");for(var _=[],a=t==r.length-1,o=a?0:r[t+1],h=0;h<e+1;++h)_.push(new Neuron(o,h));_[_.length-1].setOutputVal(1),this._m_arr_layers.push(_)}}var Neuron=require("./Neuron.js");NeuralNetwork.prototype._k_recentAvgSmoothingFactor=100,NeuralNetwork.prototype.feedForward=function(r){if(r.length!=this._m_arr_layers[0].length-1)throw new Error("(arr_inputVals.length != (m_arr_layers[0].length - 1))");for(var t=0;t<r.length;++t)this._m_arr_layers[0][t].setOutputVal(r[t]);for(var t=1;t<this._m_arr_layers.length;++t)for(var e=this._m_arr_layers[t-1],_=this._m_arr_layers[t],a=_.length-1,o=0;o<a;++o)_[o].feedForward(e)},NeuralNetwork.prototype.backProp=function(r){var t=this._m_arr_layers[this._m_arr_layers.length-1];this._m_error=0;for(var e=0;e<t.length-1;++e){var _=r[e]-t[e].getOutputVal();this._m_error+=_*_}this._m_error/=t.length-1,this._m_error=Math.sqrt(this._m_error),this._m_recentAvgError=(this._m_recentAvgError*this._k_recentAvgSmoothingFactor+this._m_error)/(this._k_recentAvgSmoothingFactor+1);for(var e=0;e<t.length-1;++e)t[e].calcOutputGradients(r[e]);for(var a=this._m_arr_layers.length-2;a>0;--a)for(var o=this._m_arr_layers[a],h=this._m_arr_layers[a+1],e=0;e<o.length;++e)o[e].calcHiddenGradients(h);for(var a=this._m_arr_layers.length-1;a>0;--a)for(var s=this._m_arr_layers[a],n=this._m_arr_layers[a-1],e=0;e<s.length-1;++e)s[e].updateInputWeights(n)},NeuralNetwork.prototype.getResults=function(r){r.length=0;for(var t=this._m_arr_layers[this._m_arr_layers.length-1],e=t.length-1,_=0;_<e;++_)r.push(t[_].getOutputVal())},NeuralNetwork.prototype.getError=function(){return this._m_error},NeuralNetwork.prototype.getRecentAverageError=function(){return this._m_recentAvgError},NeuralNetwork.prototype.getWeights=function(){for(var r=[],t=0;t<this._m_arr_layers.length-1;++t)for(var e=this._m_arr_layers[t],_=e.length-1,a=0;a<_;++a)for(var o=e[a],h=o.getOutputWeight(),s=0;s<h.length;++s)r.push(h[s].weight);return r},module.exports=NeuralNetwork;

},{"./Neuron.js":2}],2:[function(require,module,exports){
"use strict";function Neuron(t,e){this._m_layer_index=e,this._m_arr_outputWeights=[];for(var r=0;r<t;++r)this._m_arr_outputWeights.push({weight:this._randomWeight(),deltaWeight:0});this._m_outputVal=0,this._m_gradient=0}Neuron.prototype._k_eta=.15,Neuron.prototype._k_alpha=.5,Neuron.prototype._transferFunction=function(t){return Math.tanh(t)},Neuron.prototype._transferFunctionDerivative=function(t){return 1-t*t},Neuron.prototype._randomWeight=function(){return Math.random()},Neuron.prototype._sumDOW=function(t){for(var e=0,r=t.length-1,u=0;u<r;++u)e+=this._m_arr_outputWeights[u].weight*t[u]._m_gradient;return e},Neuron.prototype.feedForward=function(t){for(var e=0,r=0;r<t.length;++r)e+=t[r].getOutputVal()*t[r]._m_arr_outputWeights[this._m_layer_index].weight;this._m_outputVal=this._transferFunction(e)},Neuron.prototype.calcOutputGradients=function(t){var e=t-this._m_outputVal;this._m_gradient=e*this._transferFunctionDerivative(this._m_outputVal)},Neuron.prototype.calcHiddenGradients=function(t){var e=this._sumDOW(t);this._m_gradient=e*this._transferFunctionDerivative(this._m_outputVal)},Neuron.prototype.updateInputWeights=function(t){for(var e=0;e<t.length;++e){var r=t[e],u=r._m_arr_outputWeights[this._m_layer_index].deltaWeight,i=this._k_eta*r.getOutputVal()*this._m_gradient+this._k_alpha*u;r._m_arr_outputWeights[this._m_layer_index].deltaWeight=i,r._m_arr_outputWeights[this._m_layer_index].weight+=i}},Neuron.prototype.setOutputVal=function(t){this._m_outputVal=t},Neuron.prototype.getOutputVal=function(){return this._m_outputVal},Neuron.prototype.getOutputWeight=function(){return this._m_arr_outputWeights},module.exports=Neuron;
},{}],3:[function(require,module,exports){
"use strict";function TrainingData(t){this._arr_lines=t.trim().split("\n")}TrainingData.prototype.isEof=function(){return 0==this._arr_lines.length},TrainingData.prototype._extract_from_data=function(t,r){r.length=0;var n=this._arr_lines.shift().trim(),a=n.split(" ");if(a.length>0&&a[0]==t)for(var i=1;i<a.length;++i)r.push(parseFloat(a[i]));return r.length},TrainingData.prototype.getTopology=function(t){return this._extract_from_data("topology:",t)},TrainingData.prototype.getNextInputs=function(t){return this._extract_from_data("in:",t)},TrainingData.prototype.getTargetOutputs=function(t){return this._extract_from_data("out:",t)},module.exports=TrainingData;
},{}],4:[function(require,module,exports){
"use strict";function runNeuralNet(){function e(e){e&&(l.value+=e),l.value+="\n",l.scrollTop=l.scrollHeight}function t(t,r){for(var o=t+" ",n=0;n<r.length;++n)o+=r[n]+" ";e(o)}function r(){f.clearRect(0,0,g.width,g.height)}function o(e,t,r,o,n,a){f.strokeStyle=n,f.lineWidth=a||1,f.beginPath(),f.moveTo(e,t),f.lineTo(r,o),f.stroke()}function n(e,t,r,o){f.beginPath(),f.arc(e,t,r,0,2*Math.PI,!1),f.fillStyle=o,f.fill()}function a(e){r(),o(0,0,g.width,0,"#0000ff",10),o(g.width,0,g.width,g.height,"#0000ff",10),o(g.width,g.height,0,g.height,"#0000ff",10),o(0,g.height,0,0,"#0000ff",10);for(var t=e.getWeights(),a=0,u=0,i=0;i<t.length;++i)u=Math.max(t[i],u);for(var l=g.width/(s.length+1),f=0;f<s.length-1;++f)for(var h=g.height/(s[f]+1),c=g.height/(s[f+1]+1),v=0;v<s[f];++v)for(var d=0;d<s[f+1];++d){var m=t[a++]/u*10,T=m<0?"#0000ff":"#ff0000";m<0&&(m=-m),m<1&&(m=1),o(l+l*f,h+h*v,l+l*(f+1),c+c*d,T,m)}for(var f=0;f<s.length;++f)for(var p=g.height/(s[f]+1),w=0;w<s[f];++w)n(l+l*f,p+p*w,13,"#00ff00")}function u(){if(c.isEof())return void(curr_timeout=setTimeout(i,0));do{if(++p,l.value="",e(),e("Pass "+p),c.getNextInputs(d)!=s[0])break;if(t("Inputs:",d),v.feedForward(d),v.getResults(m),t("Outputs:",m),c.getTargetOutputs(T),t("Targets:",T),T.length!=s[s.length-1])throw new Error("(arr_targetVals.length != arr_topology.back())");if(v.backProp(T),a(v),e("Net current error: "+v.getError()),e("Net recent average error: "+v.getRecentAverageError()),p>100&&v.getRecentAverageError()<.05){e("average error acceptable -> break"),curr_timeout=setTimeout(i,10);break}curr_timeout=setTimeout(u,0)}while(!1)}function i(){if(e(),e("Done"),e(),s.length<2||2!=s[0])e("Unexpected topology, no test");else{e("TEST"),e();for(var r=[[0,0],[0,1],[1,0],[1,1]],o=0;o<4;++o)d.length=0,d.push(r[o][0]),d.push(r[o][1]),v.feedForward(d),v.getResults(m),t("Inputs:",d),t("Outputs:",m),e();e("/TEST")}}curr_timeout&&clearTimeout(curr_timeout);var l=document.getElementById("logs_area");l.value="";var g=document.getElementById("main-canvas"),f=g.getContext("2d"),h=document.getElementById("output_area").value,c=new TrainingData(h),s=[];c.getTopology(s),e("arr_topology="+JSON.stringify(s));var v=new NeuralNetwork(s),d=[],m=[],T=[],p=0;curr_timeout=setTimeout(u,0)}var TrainingData=require("./TrainingData.js"),NeuralNetwork=require("./NeuralNetwork.js"),curr_timeout=null;!function(){document.getElementById("runNeuralNet").onclick=runNeuralNet}();
},{"./NeuralNetwork.js":1,"./TrainingData.js":3}]},{},[4]);
